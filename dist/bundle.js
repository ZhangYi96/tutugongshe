!function(t){var i={};function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(s,n,function(i){return t[i]}.bind(null,n));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="dist/",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);class s{constructor(t="",i,e,s,n,h,o,a=0,r=0){this.img=new Image,this.img.src=t,this.sx=i,this.sy=e,this.swidth=s,this.sheight=n,this.x=a,this.y=r,this.width=h,this.height=o,this.visible=!0}drawToCanvas(t){this.visible&&t.drawImage(this.img,this.sx,this.sy,this.swidth,this.sheight,this.x,this.y,this.width,this.height)}isCollideWith(t){let i=t.x+t.width/2,e=t.y+t.height/2;return!(!this.visible||!t.visible)&&!!(i>=this.x&&i<=this.x+this.width&&e>=this.y&&e<=this.y+this.height)}}const n=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight,o=1920;let a=1080/n;class r extends s{constructor(t,i,e,s,n){super(i,0,0,1080,1920,0,0,1080/a,o/a),this.sizeW=e,this.sizeH=s,this.sWidth=1080,this.sHeight=1920,this.initx=n,this.minX=0,this.maxX=e-1080,this.render(t)}update(t){this.x+=t,this.x=this.x<this.minX?this.minX:this.x,this.x=this.x>this.maxX?this.maxX:this.x}init(){this.x=this.initx}render(t){t.drawImage(this.img,this.x,0,this.sWidth,this.sHeight,0,0,n,h)}isIntheExtent(t){return this.x+t>=this.minX&&this.x+t<=this.maxX}}const c=document.documentElement.clientWidth||document.body.clientWidth,d=document.documentElement.clientHeight||document.body.clientHeight;let l=1080/c*1.6;class u extends s{constructor(t,i,e,s,n,h){super(e,0,0,n,h,n/l,h/l),this.points=i,this.y=d*s[1],this.x=c*s[0],this.image=new Image,this.image.src=t,this.sx=this.points[0][0],this.sy=this.points[0][1],this.count=0}update(t,i=-1,e=-1){this.count<this.points.length?(this.y=d*t[1],this.x=c*t[0],this.sx=this.points[this.count][0],this.sy=this.points[this.count][1],this.count++):(this.y=d*t[1],this.x=c*t[0],this.img=this.image,-1==i?this.visible=!1:(this.visible=!0,this.sx=i,this.sy=e))}}const m=document.documentElement.clientWidth||document.body.clientWidth,p=document.documentElement.clientHeight||document.body.clientHeight;let v=1080/m;class g extends s{constructor(t,i,e,s,n,h,o,a,r){super(t,i,e,s,n,h,o),this.x=m*a,this.y=p*r,this.initsx=i,this.initsy=e,this.initx=m*a}fresh(t){this.x-=t/v}init(){this.x=this.initx}update(t=-1,i=-1){-1==t?(this.sx=this.initsx,this.sy=this.initsy):(this.sx=t,this.sy=i)}}const w=document.documentElement.clientWidth||document.body.clientWidth,y=document.documentElement.clientHeight||document.body.clientHeight,T=1080/w,f=1920/y;class b extends s{constructor(t,i,e,s,n,h){super(t,i[0],i[1],e[0],e[1],e[0]/T,e[1]/f),this.x1=i[0],this.x2=h[0],this.y1=i[1],this.y2=h[1],this.rect=[e[0],e[1]],this.isClearance=e[4],this.person=s,this.words=n;var o=w/2,a=y/2;this.x=o+this.width*e[2],this.y=a-this.height*e[3],this.initx=o+this.width*e[2],this.touched=!1}update(t){this.x-=t/T}init(){this.touched=!1,this.x=this.initx,this.sx=this.x1,this.sy=this.y1}initEvent(){canvas.addEventListener("touchend",(t=>{t.preventDefault()}).bind(this)),canvas.addEventListener("touchstart",(t=>{t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.checkIsFingerOnThis(i,e)?this.touched=!0:this.touched=!1}).bind(this))}updateImg(t){var i=new Image;i.src=t,this.img=i}drawToCanvas(t){1==this.touched?(this.sx=this.x2,this.sy=this.y2,0!=this.x2&&0!=this.y2&&super.drawToCanvas(t)):(this.sx=this.x1,this.sy=this.y1,this.swidth=this.rect[0],this.sheight=this.rect[1],super.drawToCanvas(t))}checkIsFingerOnThis(t,i){return!!(t>=this.x-0&&i>=this.y-0&&t<=this.x+this.width+0&&i<=this.y+this.height+0)}removeListener(){canvas.removeEventListener("touchstart",this.touchstart)}}canvas.getContext("2d");const x=document.documentElement.clientWidth||document.body.clientWidth,F=document.documentElement.clientHeight||document.body.clientHeight,I=1080/x,E=1920/F;let L=["./images/Score/Score4.png","./images/Score/Score5.png"],C=[[[810,2],[608,2],[406,2],[204,2],[2,2]],[[2,512],[2,410],[2,308],[2,206],[2,104],[2,2]]],M=200,A=100;class S extends s{constructor(t){var i=C[t][0][0],e=C[t][0][1];super(L[t],i,e,M,A,M/I,A/E,0,0),this.points=C[t];this.x=x-this.width,this.y=0,this.type=t}update(t){this.sx=this.points[t][0],this.sy=this.points[t][1]}}let H=canvas.getContext("2d");document.documentElement.clientWidth||document.body.clientWidth;const W=document.documentElement.clientHeight||document.body.clientHeight;let k=canvas.getContext("2d");document.documentElement.clientWidth||document.body.clientWidth;const X=document.documentElement.clientHeight||document.body.clientHeight;let D=canvas.getContext("2d");document.documentElement.clientWidth||document.body.clientWidth;const B=document.documentElement.clientHeight||document.body.clientHeight;let O=canvas.getContext("2d");document.documentElement.clientWidth||document.body.clientWidth;const j=document.documentElement.clientHeight||document.body.clientHeight;const q=document.documentElement.clientWidth||document.body.clientWidth,P=document.documentElement.clientHeight||document.body.clientHeight,Y=1080/q,G=1920/P;class _ extends s{constructor(t,i,e,s,n){super(t,i[0],i[1],e,s,e/Y,s/G);this.initx=q*n[0],this.x=q*n[0],this.y=P*n[1]}init(){this.touched=!1,this.x=this.initx}checkIsFingerOnThis(t,i){return!!(t>=this.x-0&&i>=this.y-0&&t<=this.x+this.width+0&&i<=this.y+this.height+0)}}const R=document.documentElement.clientWidth||document.body.clientWidth,z=document.documentElement.clientHeight||document.body.clientHeight,J=1080/R,K=1920/z;let N=canvas.getContext("2d"),Q="./images/ChooseMission/ChooseBG.png",U=[[2,646],[388,324],[2,324],[388,2],[2,2]];const V=document.documentElement.clientWidth||document.body.clientWidth,Z=document.documentElement.clientHeight||document.body.clientHeight,$=1080/V,tt=1920/Z,it=new class{init(){this.atlas=new Image,this.atlas.src=Q,this.miss=[];for(var t=0;t<U.length;t++){var i=Math.floor(t/2),e=t%2,s=new _("images/ChooseMission/ChooseMission.png",U[t],384,320,[.136+.38*e,.21+.17*i]);this.miss.push(s)}this.chooseMission=-1,this.fanwai=new _("images/Setting/Setting.png",[107,2],103,146,[.1,.91]),this.egg=new _("images/Setting/Setting.png",[317,2],103,146,[.33,.91]),this.test=new _("images/Setting/Setting.png",[212,2],103,146,[.57,.91]),this.setting=new _("images/Setting/Setting.png",[2,2],103,146,[.8,.91]),this.bindLoop=this.loop.bind(this),this.restart()}restart(){this.chooseMission=-1,this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.touchstart=this.choose.bind(this),canvas.addEventListener("touchstart",this.touchstart)}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}choose(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;for(var s=0;s<this.miss.length;s++)if(this.miss[s].checkIsFingerOnThis(i,e)&&s<4){this.chooseMission=s;break}console.log(this.chooseMission)}render(){N.drawImage(this.atlas,0,0,1080,1920,0,0,1080/J,1920/K);for(var t=0;t<this.miss.length;t++)this.miss[t].drawToCanvas(N);this.egg.drawToCanvas(N),this.test.drawToCanvas(N),this.fanwai.drawToCanvas(N),this.setting.drawToCanvas(N),this.chooseMission>-1&&(console.log("choose to mission"),window.cancelAnimationFrame(this.aniId),canvas.removeEventListener("touchstart",this.touchstart),pt[this.chooseMission].restart())}};let et=canvas.getContext("2d"),st="./images/Begin/BG.png";const nt=document.documentElement.clientWidth||document.body.clientWidth,ht=document.documentElement.clientHeight||document.body.clientHeight,ot=1080/nt,at=1920/ht;let rt,ct=canvas.getContext("2d");e.d(i,"Mission",function(){return pt}),e.d(i,"complete",function(){return vt}),e.d(i,"start",function(){return gt}),e.d(i,"music",function(){return wt});var dt=document.getElementById("canvas");const lt=document.documentElement.clientWidth||document.body.clientWidth,ut=document.documentElement.clientHeight||document.body.clientHeight;dt.width=lt,dt.height=ut;const mt=new class{constructor(){this.aniId=0,this.MissionId=1,this.personalHighScore=null,this.scale=1920/W,this.keyImg="./images/Mission2/Mission2object.png",this.lastx=0,this.init()}init(){this.rightwindow=new b(this.keyImg,[1433,506],[340,580,.3,.5],[-1,-1],[-1,-1],[416,506]);var t=[[[124,841],[0,0],[1208,2],[2,2]],[[691,826],[691,561],[1610,2],[1041,2]],[[397,841],[0,0],[2,2],[2,464]],[[558,841],[0,0],[1208,2],[2,926]],[[2,841],[0,0],[404,2],[1041,464]],[[2,2],[0,0],[1208,2],[2,1850]]],i=[[271,235,2.1,-.85,0],[319,263,3.5,2.65,1],[159,216,11.5,-.9,1],[65,107,47.9,3.1,1],[120,247,11,-.65,1],[687,837,-.3,0,0]];this.bg=new r(H,"images/Mission2/BG2.png",4005,1920,0);for(var e=[],s=0;s<t.length;s++){var n=new b(this.keyImg,t[s][0],i[s],t[s][2],t[s][3],t[s][1]);e.push(n)}this.spritesForType2=e,this.women=new b("./images/Mission2/Mission2object.png",[691,2],[331,557,-1,1.11,0],[0,0],[-1,-1],[-1,-1]),this.player=new g("./images/Mission2/Mission2person.png",1208,2,400,930,400/this.scale,930/this.scale,0,.5),this.welcome=new u("./images/Mission2/Mission2words.png",[[1041,1850],[1041,1388],[2,1388],[1041,926]],"./images/Mission2/Mission2words.png",[.3,.7],1037,460),this.scoreImg=new S(0)}restart(){this.scores=[0,0,0,0],this.bindLoop=this.loop.bind(this);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].init();this.rightwindow.init(),this.women.init(),this.hasEventBind=!1,this.bg.init(),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.initevent()}render(){if(this.isSuccess()<this.scores.length){this.bg.render(H),this.women.drawToCanvas(H);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].drawToCanvas(H);this.welcome.drawToCanvas(H),this.rightwindow.drawToCanvas(H),this.player.drawToCanvas(H),this.scoreImg.drawToCanvas(H)}else this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/complete2.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart);this.women.touched&&(this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/fail2.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart))}completetouch(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.completeScene.again.checkIsFingerOnThis(i,e)&&(canvas.removeEventListener("touchstart",this.touchstart),this.restart())}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}initevent(){this.touchstart=this.eventTouchstart.bind(this),canvas.addEventListener("touchstart",this.touchstart),this.touchend=this.eventTouchend.bind(this),canvas.addEventListener("touchend",this.touchend),this.touchmove=this.eventTouchmove.bind(this),canvas.addEventListener("touchmove",this.touchmove)}isSuccess(){var t=0;return this.scores.forEach(function(i){t+=i}),t}eventTouchstart(t){t.preventDefault();let i=t.touches[0].clientX;this.lastx=i}eventTouchend(t){t.preventDefault();var i=-1;if(this.welcome.count<4)this.welcome.count<2?this.welcome.update([.4,.3]):this.welcome.update([.3,.7]);else{for(var e=[-1,-1],s=[-1,-1],n=!1,h=0;h<this.spritesForType2.length;h++)1==this.spritesForType2[h].isClearance&&i++,this.spritesForType2[h].touched&&(1==this.spritesForType2[h].isClearance&&(this.scores[i]=1),e=this.spritesForType2[h].person,s=this.spritesForType2[h].words,n=!0),this.spritesForType2[h].click();n||(i++,i++),this.player.update(e[0],e[1]),this.welcome.update([.3,.7],s[0],s[1])}this.scoreImg.update(this.isSuccess())}eventTouchmove(t){if(t.preventDefault(),this.welcome.count>3){let s=t.touches[0].clientX;var i=(this.lastx-s)*this.scale;if(console.log("移动"+i),this.bg.isIntheExtent(i)){this.bg.update(i);for(var e=0;e<this.spritesForType2.length;e++)this.spritesForType2[e].update(i);this.women.update(i),this.rightwindow.update(i),this.lastx=s}}}removeAllTouchListner(){if(canvas.removeEventListener("touchstart",this.touchstart),canvas.removeEventListener("touchend",this.touchend),canvas.removeEventListener("touchmove",this.touchmove),void 0!==this.spritesForType2){for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].removeListener();this.rightwindow.removeListener()}}},pt=[new class{constructor(){this.aniId=0,this.MissionId=0,this.personalHighScore=null,this.scale=1920/X,this.keyImg="./images/Mission1/object.png",this.lastx=0,this.init()}init(){this.rightwindow=new b(this.keyImg,[631,1],[313,573,.3,.5],[-1,-1],[-1,-1],[946,1]),this.fly=new b(this.keyImg,[839,861],[64,74,3.5,1,1],[855,1],[1,639],[0,0]),this.fly.visible=!1;var t=[[[839,576],[1113,576],[1,1],[749,639]],[[1,576],[420,576],[855,938],[1,320]],[[1370,351],[0,0],[428,1],[1,1]],[[906,861],[0,0],[428,1],[749,1]],[[1261,351],[0,0],[1,938],[749,320]],[[1261,201],[0,0],[428,1],[749,1277]],[[1,1],[316,1],[-1,-1],[-1,-1]]],i=[[272,283,2.9,1.3,1],[417,361,-3.1,.38,1],[59,118,13,.82,0],[112,50,9,.61,0],[107,105,19.5,-1.8,1],[137,148,7.8,-1,0],[313,573,-.5,.5,0]];this.bg=new r(k,"images/Mission1/BG.png",4e3,1920,1080),this.pic=new b(this.keyImg,[1261,1],[176,198,7,2,0],[0,0],[0,1200],[340,140]);for(var e=[],s=0;s<t.length;s++){var n=new b(this.keyImg,t[s][0],i[s],t[s][2],t[s][3],t[s][1]);e.push(n)}this.spritesForType2=e,this.player=new g("./images/Mission1/person.png",428,938,425,935,425/this.scale,935/this.scale,0,.5),this.welcome=new u("./images/Mission1/word.png",[[1,958],[1,1277],[1,1596],[1,958]],"images/Mission1/word.png",[.3,.7],746,317),this.scoreImg=new S(0)}restart(){this.scores=[0,0,0,0],this.bindLoop=this.loop.bind(this);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].init();this.fly.init(),this.rightwindow.init(),this.pic.init(),this.hasEventBind=!1,this.bg.init(),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.initevent()}render(){if(k.clearRect(0,0,canvas.width,canvas.height),this.isSuccess()<this.scores.length){this.bg.render(k);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].drawToCanvas(k);this.pic.drawToCanvas(k),this.welcome.drawToCanvas(k),this.rightwindow.drawToCanvas(k),this.fly.drawToCanvas(k),this.player.drawToCanvas(k),this.scoreImg.drawToCanvas(k)}else this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/complete1.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart);if(1==this.pic.touched&&(this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/fail1.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart)),4==this.welcome.count){for(t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].initEvent();this.rightwindow.initEvent(),this.fly.initEvent(),this.pic.initEvent(),this.welcome.count=5}}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}initevent(){this.touchstart=this.eventTouchstart.bind(this),canvas.addEventListener("touchstart",this.touchstart),this.touchend=this.eventTouchend.bind(this),canvas.addEventListener("touchend",this.touchend),this.touchmove=this.eventTouchmove.bind(this),canvas.addEventListener("touchmove",this.touchmove)}isSuccess(){var t=0;return this.scores.forEach(function(i){t+=i}),t}eventTouchstart(t){t.preventDefault(),console.log("touchstart");let i=t.touches[0].clientX;this.lastx=i}eventTouchend(t){t.preventDefault(),console.log("touchend");var i=-1;if(this.welcome.count<4)this.welcome.update([.3,.7]);else{for(var e=[-1,-1],s=[-1,-1],n=0;n<this.spritesForType2.length;n++)1==this.spritesForType2[n].isClearance&&i++,this.spritesForType2[n].touched&&(1==this.spritesForType2[n].isClearance&&(this.scores[i]=1),e=this.spritesForType2[n].person,s=this.spritesForType2[n].words);i++,this.fly.touched&&(this.scores[i]=1,e=this.fly.person,s=this.fly.words),this.rightwindow.touched?this.fly.visible=!0:this.fly.visible=!1,this.player.update(e[0],e[1]),this.welcome.update([.3,.7],s[0],s[1])}this.scoreImg.update(this.isSuccess())}eventTouchmove(t){if(t.preventDefault(),this.welcome.count>3){let s=t.touches[0].clientX;var i=(this.lastx-s)*this.scale;if(console.log("移动"+i),this.bg.isIntheExtent(i)){this.bg.update(i);for(var e=0;e<this.spritesForType2.length;e++)this.spritesForType2[e].update(i);this.pic.update(i),this.fly.update(i),this.rightwindow.update(i),this.lastx=s}}}removeAllTouchListner(){if(canvas.removeEventListener("touchstart",this.touchstart),canvas.removeEventListener("touchend",this.touchend),canvas.removeEventListener("touchmove",this.touchmove),void 0!==this.spritesForType2){for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].removeListener();this.pic.removeListener(),this.fly.removeListener(),this.rightwindow.removeListener()}}},mt,new class{constructor(){this.aniId=0,this.MissionId=2,this.personalHighScore=null,this.scale=1920/B,this.keyImg="./images/Mission3/object.png",this.lastx=0,this.init()}init(){var t=[[[1,789],[0,0],[-1,-1],[1,1]],[[546,480],[0,0],[-1,-1],[749,1]],[[546,279],[0,0],[-1,-1],[1,320]],[[546,1],[0,0],[-1,-1],[749,320]],[[546,1],[0,0],[-1,-1],[749,320]],[[546,1],[0,0],[-1,-1],[749,320]],[[1,400],[0,0],[-1,-1],[-1,-1]],[[398,1],[0,0],[-1,-1],[1,639]],[[375,690],[0,0],[-1,-1],[1,958]]],i=[[182,131,-5,0,0],[181,181,4,2.65,1],[161,199,5.5,.6,1],[168,276,1,3.5,1],[168,276,-2,3.5,1],[168,276,-5,3.5,1],[372,387,-1,.8,0],[146,687,-13,.2,1],[191,257,-5,2,1]];this.bg=new r(D,"images/Mission3/BG.png",4012,1920,1580);for(var e=[],s=0;s<t.length;s++){var n=new b(this.keyImg,t[s][0],i[s],t[s][2],t[s][3],t[s][1]);e.push(n)}this.spritesForType2=e,this.fail=new b("./images/Mission3/object.png",[1,1],[395,397,3,1,1],[0,0],[-1,-1],[-1,-1]),this.player=new g("./images/Mission2/Mission2person.png",1208,2,400,930,400/this.scale,930/this.scale,0,.5),this.welcome=new u("./images/Mission3/word.png",[[1,958],[749,958]],"./images/Mission3/word.png",[.3,.7],746,317),this.scoreImg=new S(1)}restart(){this.scores=[0,0,0,0,0],this.bindLoop=this.loop.bind(this);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].init();this.fail.init(),this.hasEventBind=!1,this.bg.init(),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.initevent()}render(){if(D.clearRect(0,0,canvas.width,canvas.height),this.isSuccess()<this.scores.length){this.bg.render(D),this.fail.drawToCanvas(D);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].drawToCanvas(D);this.welcome.drawToCanvas(D),this.player.drawToCanvas(D),this.scoreImg.drawToCanvas(D)}else this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/complete3.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart);if(this.fail.touched&&(this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/fail3.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart)),2==this.welcome.count){for(t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].initEvent();this.fail.initEvent(),this.welcome.count++}}completetouch(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.completeScene.again.checkIsFingerOnThis(i,e)&&(canvas.removeEventListener("touchstart",this.touchstart),this.restart())}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}initevent(){this.touchstart=this.eventTouchstart.bind(this),canvas.addEventListener("touchstart",this.touchstart),this.touchend=this.eventTouchend.bind(this),canvas.addEventListener("touchend",this.touchend),this.touchmove=this.eventTouchmove.bind(this),canvas.addEventListener("touchmove",this.touchmove)}isSuccess(){var t=0;return this.scores.forEach(function(i){t+=i}),t}eventTouchstart(t){t.preventDefault();let i=t.touches[0].clientX;this.lastx=i}eventTouchend(t){t.preventDefault();var i=-1;if(this.welcome.count<2)this.welcome.count<1?this.welcome.update([.4,.3]):this.welcome.update([.3,.7]);else{for(var e=[-1,-1],s=[-1,-1],n=!1,h=0;h<this.spritesForType2.length;h++)1==this.spritesForType2[h].isClearance&&5!=h&&4!=h&&i++,this.spritesForType2[h].touched&&(1==this.spritesForType2[h].isClearance&&(this.scores[i]=1),e=this.spritesForType2[h].person,s=this.spritesForType2[h].words,n=!0);n||(i++,i++),this.player.update(e[0],e[1]),this.welcome.update([.3,.7],s[0],s[1])}this.scoreImg.update(this.isSuccess())}eventTouchmove(t){if(t.preventDefault(),this.welcome.count>1){let s=t.touches[0].clientX;var i=(this.lastx-s)*this.scale;if(console.log("移动"+i),this.bg.isIntheExtent(i)){this.bg.update(i);for(var e=0;e<this.spritesForType2.length;e++)this.spritesForType2[e].update(i);this.fail.update(i),this.lastx=s}}}removeAllTouchListner(){if(canvas.removeEventListener("touchstart",this.touchstart),canvas.removeEventListener("touchend",this.touchend),canvas.removeEventListener("touchmove",this.touchmove),void 0!==this.spritesForType2){for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].removeListener();this.fail.removeListener()}}},new class{constructor(){this.aniId=0,this.MissionId=3,this.personalHighScore=null,this.scale=1920/j,this.keyImg="./images/Mission4/object.png",this.lastx=0,this.init()}init(){var t=[[[1,911],[0,0],[-1,-1],[749,639]],[[477,576],[0,0],[-1,-1],[1,1]],[[265,850],[0,0],[-1,-1],[749,320]],[[753,576],[0,0],[-1,-1],[1,639]],[[265,1],[0,0],[-1,-1],[1,958]],[[1,1],[0,0],[-1,-1],[749,958]],[[1051,1],[0,0],[-1,-1],[1,1277]]],i=[[85,46,-21.9,-5.9,0],[274,266,-4.73,2.88,1],[406,138,2.2,3.3,1],[370,229,2.5,-2.5,1],[784,573,.8,0,1],[262,908,-9,.4,0],[133,565,-6,.6,1]];this.bg=new r(O,"images/Mission4/BG.png",4012,1920,2e3);for(var e=[],s=0;s<t.length;s++){var n=new b(this.keyImg,t[s][0],i[s],t[s][2],t[s][3],t[s][1]);e.push(n)}this.spritesForType2=e,this.fail=new b("./images/Mission4/object.png",[265,576],[210,272,-6.67,.8,1],[0,0],[-1,-1],[-1,-1]),this.player=new g("./images/Mission2/Mission2person.png",1208,2,400,930,400/this.scale,930/this.scale,0,.5),this.welcome=new u("./images/Mission4/word.png",[[1,320],[749,320]],"./images/Mission4/word.png",[.3,.7],746,317),this.scoreImg=new S(1)}restart(){this.scores=[0,0,0,0,0],this.bindLoop=this.loop.bind(this);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].init();this.fail.init(),this.hasEventBind=!1,this.bg.init(),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.initevent()}render(){if(O.clearRect(0,0,canvas.width,canvas.height),this.isSuccess()<this.scores.length){this.bg.render(O),this.fail.drawToCanvas(O);for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].drawToCanvas(O);this.welcome.drawToCanvas(O),this.player.drawToCanvas(O),this.scoreImg.drawToCanvas(O)}else this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/complete4.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart);if(this.fail.touched&&(this.removeAllTouchListner(),window.cancelAnimationFrame(this.aniId),vt.init("./images/extra/fail4.png",this.MissionId),canvas.addEventListener("touchstart",vt.touchstart)),2==this.welcome.count){for(t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].initEvent();this.fail.initEvent(),this.welcome.count++}}completetouch(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.completeScene.again.checkIsFingerOnThis(i,e)&&(canvas.removeEventListener("touchstart",this.touchstart),this.restart())}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}initevent(){this.touchstart=this.eventTouchstart.bind(this),canvas.addEventListener("touchstart",this.touchstart),this.touchend=this.eventTouchend.bind(this),canvas.addEventListener("touchend",this.touchend),this.touchmove=this.eventTouchmove.bind(this),canvas.addEventListener("touchmove",this.touchmove)}isSuccess(){var t=0;return this.scores.forEach(function(i){t+=i}),t}eventTouchstart(t){t.preventDefault();let i=t.touches[0].clientX;this.lastx=i}eventTouchend(t){t.preventDefault();var i=-1;if(this.welcome.count<2)this.welcome.count<1?this.welcome.update([.4,.3]):this.welcome.update([.3,.7]);else{for(var e=[-1,-1],s=[-1,-1],n=!1,h=0;h<this.spritesForType2.length;h++)1==this.spritesForType2[h].isClearance&&5!=h&&4!=h&&i++,this.spritesForType2[h].touched&&(1==this.spritesForType2[h].isClearance&&(this.scores[i]=1),e=this.spritesForType2[h].person,s=this.spritesForType2[h].words,n=!0);n||(i++,i++),this.player.update(e[0],e[1]),this.welcome.update([.3,.7],s[0],s[1])}this.scoreImg.update(this.isSuccess())}eventTouchmove(t){if(t.preventDefault(),this.welcome.count>1){let s=t.touches[0].clientX;var i=(this.lastx-s)*this.scale;if(console.log("移动"+i),this.bg.isIntheExtent(i)){this.bg.update(i);for(var e=0;e<this.spritesForType2.length;e++)this.spritesForType2[e].update(i);this.fail.update(i),this.lastx=s}}}removeAllTouchListner(){if(canvas.removeEventListener("touchstart",this.touchstart),canvas.removeEventListener("touchend",this.touchend),canvas.removeEventListener("touchmove",this.touchmove),void 0!==this.spritesForType2){for(var t=0;t<this.spritesForType2.length;t++)this.spritesForType2[t].removeListener();this.fail.removeListener()}}}],vt=new class{constructor(){this.atlas=new Image}init(t,i){this.missionId=i,this.clickType=-1,this.atlas.src=t,this.again=new _("images/extra/btnsprite.png",[1462,164],407,122,[.05,.3]),this.next=new _("images/extra/btnsprite.png",[1053,164],407,122,[.55,.3]),this.getCet=new _("images/extra/btnsprite.png",[1,181],407,122,[.3,.4]),this.touchstart=this.completetouch.bind(this),this.bindLoop=this.loop.bind(this),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas)}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}render(){ct.drawImage(this.atlas,0,0,1080,1920,0,0,1080/ot,1920/at),this.again.drawToCanvas(ct),this.next.drawToCanvas(ct),this.getCet.drawToCanvas(ct),0==this.clickType?(window.cancelAnimationFrame(this.aniId),canvas.removeEventListener("touchstart",vt.touchstart),pt[vt.missionId].restart()):1==vt.clickType&&(window.cancelAnimationFrame(this.aniId),canvas.removeEventListener("touchstart",vt.touchstart),vt.missionId<2?pt[vt.missionId+1].restart():it.restart())}completetouch(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;console.log(vt.clickType),vt.again.checkIsFingerOnThis(i,e)&&(vt.clickType=0),vt.next.checkIsFingerOnThis(i,e)&&(vt.clickType=1)}},gt=new class{init(){this.atlas=new Image,this.atlas.src=st,this.point=new Image,this.point.src="./images/extra/point.png",this.pointx=-1,this.pointy=-1,this.pointShow=0,wt.playBgm(),this.start=new _("./images/Begin/start.png",[0,0],910,361,[.08,.7]),this.start.drawToCanvas(et),this.isStart=0,this.bindLoop=this.loop.bind(this),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.touchstart=this.completetouch.bind(this),canvas.addEventListener("touchstart",this.touchstart),this.pointstart=this.pointtouch.bind(this),canvas.addEventListener("touchstart",this.pointstart),this.pointmove=this.touchmove.bind(this),canvas.addEventListener("touchstart",this.pointmove)}loop(){this.aniId=window.requestAnimationFrame(this.bindLoop,canvas),this.render()}completetouch(t){console.log(1),t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.start.checkIsFingerOnThis(i,e)&&(this.isStart=1)}pointtouch(t){t.preventDefault(),wt.playShoot(),this.pointx=t.touches[0].clientX,this.pointy=t.touches[0].clientY}touchmove(t){t.preventDefault(),this.pointx=t.touches[0].clientX,this.pointy=t.touches[0].clientY,et.drawImage(this.point,this.pointx,this.pointy)}render(){0==this.isStart&&(et.drawImage(this.atlas,0,0,1080,1920,0,0,1080/$,1920/tt),this.start.drawToCanvas(et)),this.pointShow>0&&(this.pointShow--,et.drawImage(this.point,this.pointx,this.pointy)),1==this.isStart&&(this.isStart=2,canvas.removeEventListener("touchstart",this.touchstart),canvas.addEventListener("touchstart",this.pointstart),it.init())}},wt=new class{constructor(){if(rt)return rt;rt=this,this.bgmAudio=new Audio,this.bgmAudio.loop=!0,this.bgmAudio.src="audio/bgm.mp3",this.shootAudio=new Audio,this.shootAudio.src="audio/click.mp3",this.isPlayBgm=1,this.isPlayShoot=1,this.playBgm()}playBgm(){1==this.isPlayBgm?this.bgmAudio.play():this.bgmAudio.pause()}playShoot(){1==this.isPlayShoot&&(this.shootAudio.currentTime=0,this.shootAudio.play())}playExplosion(){this.boomAudio.currentTime=0,this.boomAudio.play()}};gt.init()}]);